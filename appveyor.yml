version: 1.73.{build}

clone_depth: 10

environment:
  matrix:
    - VisualStudioVersion: 12.0
      platform: "Win32"
      configuration: "Debug"
      vcvarsall_platform: "x86"
      PlatformToolset: "v120"
    - VisualStudioVersion: 12.0
      platform: "Win32"
      configuration: "Release"
      vcvarsall_platform: "x86"
      PlatformToolset: "v120"
    - VisualStudioVersion: 12.0
      platform: "x64"
      configuration: "Debug"
      vcvarsall_platform: "x64"
      PlatformToolset: "v120"
    - VisualStudioVersion: 12.0
      platform: "x64"
      configuration: "Release"
      vcvarsall_platform: "x64"
      PlatformToolset: "v120"
    - VisualStudioVersion: 14.0
      platform: "Win32"
      configuration: "Debug"
      vcvarsall_platform: "x86"
      PlatformToolset: "v140"
    - VisualStudioVersion: 14.0
      platform: "x64"
      configuration: "Debug"
      vcvarsall_platform: "x64"
      PlatformToolset: "v140"

build_script:
  - ECHO Building %configuration% %platform% with MSVC %VisualStudioVersion% using %PlatformToolset% PlatformToolset
  - 'CALL "C:\Program Files (x86)\Microsoft Visual Studio %VisualStudioVersion%\VC\vcvarsall.bat" %vcvarsall_platform%'
  - msbuild "cppcheck.sln" /consoleloggerparameters:Verbosity=minimal /target:Build /property:Configuration="%configuration%";Platform=%platform% /p:PlatformToolset=%PlatformToolset% /maxcpucount /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
  - IF "%platform%" == "Win32" set QTDIR_EXT=32
  - IF "%platform%" == "x64"   set QTDIR_EXT=64
  - IF "%PlatformToolset%" == "v120" set QTDIR=C:\Qt\5.10.1\msvc2013_%QTDIR_EXT%
  - IF "%PlatformToolset%" == "v140" set QTDIR=C:\Qt\5.10.1\msvc2015_%QTDIR_EXT%
  - cd gui 
  - '%QTDIR%\bin\qmake'
  - cd ..

test_script:
  - IF "%CONFIGURATION%" == "Debug"   bin\debug\testrunner.exe
  - IF "%CONFIGURATION%" == "Release" bin\testrunner.exe

artifacts:
  - path: bin
    name: CLI binaries
    type: zip
